GPT=$(HOME)/snap/bin/gpt

all: target_final.dim

.DELETE_ON_ERROR:

FILENAME1=S1A_IW_SLC__1SDV_20230713T061549_20230713T061617_049401_05F0B7_C53F.zip
FILENAME1=S1A_IW_SLC__1SDV_20230725T061550_20230725T061618_049576_05F613_E61B.zip
FILENAME1=S1A_IW_SLC__1SDV_20230806T061551_20230806T061619_049751_05FB78_2102.zip
FILENAME1=S1A_IW_SLC__1SDV_20230420T061544_20230420T061612_048176_05CAC8_F882.zip
FILENAME1=S1A_IW_SLC__1SDV_20230114T061545_20230114T061613_046776_059B9A_6149.zip
FILENAME1=S1A_IW_SLC__1SDV_20230126T061545_20230126T061613_046951_05A183_D796.zip
FILENAME1=S1A_IW_SLC__1SDV_20230327T061544_20230327T061612_047826_05BF01_E79B.zip
FILENAME1=S1A_IW_SLC__1SDV_20221103T061548_20221103T061616_045726_0577FA_5A34.zip
FILENAME1=S1A_IW_SLC__1SDV_20230514T061546_20230514T061614_048526_05D641_8E17.zip
FILENAME1=S1A_IW_SLC__1SDV_20210921T061542_20210921T061610_039776_04B44F_FE64.zip
FILENAME1=S1A_IW_SLC__1SDV_20230102T061546_20230102T061614_046601_0595B9_8492.zip
FILENAME1=S1A_IW_SLC__1SDV_20230514T061546_20230514T061614_048526_05D641_8E17.zip
FILENAME1=S1A_IW_SLC__1SDV_20230526T061547_20230526T061614_048701_05DB69_ED51.zip
FILENAME1=S1A_IW_SLC__1SDV_20230619T061548_20230619T061616_049051_05E5FF_D364.zip
FILENAME1=S1A_IW_SLC__1SDV_20210909T061541_20210909T061609_039601_04AE59_06A5.zip
FILENAME1=S1A_IW_SLC__1SDV_20211003T061542_20211003T061610_039951_04BA5D_268F.zip
FILENAME1=S1A_IW_SLC__1SDV_20230607T061547_20230607T061615_048876_05E0AA_95E7.zip
FILENAME1=S1B_IW_SLC__1SDV_20211009T061500_20211009T061528_029055_03778A_E225.zip
FILENAME1=S1B_IW_SLC__1SDV_20211220T061459_20211220T061526_030105_039838_925D.zip
FILENAME1=S1B_IW_SLC__1SDV_20210915T061500_20210915T061528_028705_036CEF_FFB0.zip
FILENAME1=S1B_IW_SLC__1SDV_20210927T061500_20210927T061528_028880_03724B_2AD8.zip
FILENAME1=S1A_IW_SLC__1SDV_20230701T061548_20230701T061616_049226_05EB4A_BD1F.zip
FILENAME1=S1B_IW_SLC__1SDV_20211009T061500_20211009T061528_029055_03778A_E225.zip
FILENAME1=S1A_IW_SLC__1SDV_20230315T061544_20230315T061611_047651_05B91C_ED1A.zip
FILENAME1=S1A_IW_SLC__1SDV_20230408T061544_20230408T061612_048001_05C4EB_7C1B.zip
FILENAME1=S1A_IW_SLC__1SDV_20230502T061545_20230502T061613_048351_05D0AC_1DEE.zip
FILENAME1=S1A_IW_SLC__1SDV_20230303T061544_20230303T061612_047476_05B32D_5B23.zip
FILENAME1=S1A_IW_SLC__1SDV_20211027T061542_20211027T061610_040301_04C684_3329.zip
FILENAME1=S1A_IW_SLC__1SDV_20211108T061542_20211108T061610_040476_04CC9F_BA30.zip
FILENAME1=S1B_IW_SLC__1SDV_20211102T061500_20211102T061528_029405_03825E_D94F.zip
FILENAME1=S1A_IW_SLC__1SDV_20211015T061542_20211015T061610_040126_04C067_5886.zip
FILENAME1=S1A_IW_SLC__1SDV_20211120T061542_20211120T061610_040651_04D2A2_8711.zip
FILENAME1=S1B_IW_SLC__1SDV_20211114T061500_20211114T061528_029580_0387AF_7244.zip
FILENAME1=S1A_IW_SLC__1SDV_20211120T061542_20211120T061610_040651_04D2A2_8711.zip
FILENAME1=S1A_IW_SLC__1SDV_20211120T061542_20211120T061610_040651_04D2A2_F567.zip
FILENAME1=S1A_IW_SLC__1SDV_20230207T061544_20230207T061612_047126_05A75C_D80A.zip
FILENAME1=S1A_IW_SLC__1SDV_20230219T061544_20230219T061612_047301_05AD42_3202.zip
FILENAME1=S1A_IW_SLC__1SDV_20230713T061549_20230713T061617_049401_05F0B7_C53F.zip
FILENAME1=S1A_IW_SLC__1SDV_20211202T061541_20211202T061609_040826_04D8BE_04B2.zip
FILENAME1=S1A_IW_SLC__1SDV_20211226T061540_20211226T061608_041176_04E486_8F35.zip
FILENAME1=S1A_IW_SLC__1SDV_20220107T061539_20220107T061607_041351_04EA7F_BAAF.zip
FILENAME1=S1A_IW_SLC__1SDV_20220507T061540_20220507T061608_043101_0525A1_0B63.zip
FILENAME1=S1B_IW_SLC__1SDV_20211208T061459_20211208T061527_029930_0392AC_BD93.zip
FILENAME1=S1A_IW_SLC__1SDV_20220119T061539_20220119T061607_041526_04F038_5F00.zip
FILENAME1=S1A_IW_SLC__1SDV_20220131T061538_20220131T061606_041701_04F630_6BA8.zip
FILENAME1=S1A_IW_SLC__1SDV_20220212T061538_20220212T061606_041876_04FC3C_C0C9.zip
FILENAME1=S1A_IW_SLC__1SDV_20211214T061541_20211214T061609_041001_04DEC6_0E05.zip
FILENAME1=S1A_IW_SLC__1SDV_20221221T061546_20221221T061614_046426_058FCD_55A6.zip
FILENAME1=S1A_IW_SLC__1SDV_20220811T061546_20220811T061614_044501_054F75_093C.zip
FILENAME1=S1A_IW_SLC__1SDV_20220612T061543_20220612T061610_043626_053560_08DB.zip
FILENAME1=S1A_IW_SLC__1SDV_20220730T061545_20220730T061613_044326_054A3A_4166.zip
FILENAME1=S1A_IW_SLC__1SDV_20220904T061548_20220904T061616_044851_055B4A_79A3.zip
FILENAME1=S1A_IW_SLC__1SDV_20220928T061548_20220928T061616_045201_05670A_141D.zip
FILENAME1=S1A_IW_SLC__1SDV_20220224T061538_20220224T061606_042051_050253_D08E.zip
FILENAME1=S1A_IW_SLC__1SDV_20220308T061538_20220308T061606_042226_050846_49AC.zip
FILENAME1=S1A_IW_SLC__1SDV_20221209T061547_20221209T061615_046251_0589CF_FD89.zip
FILENAME1=S1A_IW_SLC__1SDV_20221127T061548_20221127T061616_046076_0583D4_91A5.zip
FILENAME1=S1A_IW_SLC__1SDV_20221115T061548_20221115T061616_045901_057DED_C7C5.zip
FILENAME1=S1A_IW_SLC__1SDV_20221022T061548_20221022T061616_045551_057216_2CA3.zip
FILENAME1=S1A_IW_SLC__1SDV_20221010T061548_20221010T061616_045376_056CE9_CC28.zip
FILENAME1=S1A_IW_SLC__1SDV_20220916T061548_20220916T061616_045026_056129_CB8D.zip
FILENAME1=S1A_IW_SLC__1SDV_20220823T061547_20220823T061615_044676_055561_B198.zip
FILENAME1=S1A_IW_SLC__1SDV_20220401T061538_20220401T061606_042576_05141F_1EC1.zip
FILENAME1=S1A_IW_SLC__1SDV_20220320T061538_20220320T061606_042401_050E33_135C.zip
FILENAME1=S1A_IW_SLC__1SDV_20220413T061539_20220413T061606_042751_051A0B_5C1F.zip
FILENAME1=S1A_IW_SLC__1SDV_20220519T061541_20220519T061608_043276_052B02_1EAF.zip
FILENAME1=S1A_IW_SLC__1SDV_20220706T061544_20220706T061612_043976_053FD2_D86C.zip
FILENAME1=S1A_IW_SLC__1SDV_20220718T061545_20220718T061613_044151_054514_02A7.zip
FILENAME1=S1A_IW_SLC__1SDV_20220531T061542_20220531T061610_043451_053034_9C9C.zip
FILENAME1=S1A_IW_SLC__1SDV_20220624T061543_20220624T061611_043801_053A9F_012F.zip

# Split
target_split.dim: $(FILENAME1)
	$(GPT) TOPSAR-Split -Ssource=$(FILENAME1) -PfirstBurstIndex=6 -PlastBurstIndex=6 -Psubswath=IW3 -t target_split

# Orbital Params
target_orb.dim: target_split.dim
	$(GPT) Apply-Orbit-File -Ssource=target_split.dim -t target_orb

target_cal.dim: target_orb.dim
	$(GPT) Calibration -SsourceProduct=target_orb.dim -t target_cal.dim -c 2048M -q 2 

# Deburst
# target_deburst.dim: $(DATA1) # target_orb.dim
target_deburst.dim: target_cal.dim
	$(GPT) TOPSAR-Deburst -SsourceProduct=target_cal.dim -t target_deburst.dim -c 2048M -q 2 
	# $(GPT) TOPSAR-Deburst -SsourceProduct=$(DATA1) -t target_deburst.dim -c 2048M -q 2 

# Range Doppler Terrain: cf qgis for map projection
# attention : phase et intensity sont des RESULTS de i et q et ne sont pas stockes, mais il faut
#   quand meme exporter complex pour continuer !
target_final.dim: target_deburst.dim
	$(GPT) Terrain-Correction -SsourceProduct=target_deburst.dim -PdemName="External DEM" -PexternalDEMFile="/home/jmfriedt/spitsberg/isprs/2019/DEM.tif" -PexternalDEMNoDataValue=0.0 -PmapProjection="EPSG:32633" -t target_final.dim
	$(eval nom=`echo $(FILENAME1) | cut -c 20-25`)
	gdal_translate -of GTiff ./target_final.data/Si*VV*.img final_sigma0_intensityVV$(nom).tif


clean:
	rm -rf target*
# TODO
# catch
# Exception in thread "SunTileScheduler0Standard1" java.lang.NullPointerException
# and restart until we get through
